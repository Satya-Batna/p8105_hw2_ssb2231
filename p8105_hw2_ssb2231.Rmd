---
title: "P8105_hw2_sbb2231"
author: "Satya Batna (sbb2231)"
output: github_document
---
#Problem 2
```{r}
library (tidyverse)
library(readxl)
library(dplyr)

# --- Read & clean each sheet (omit notes by dropping rows with missing Dumpster) ---

# Mr. Trash Wheel  (all rows; columns A:N)
mr_trash <- read_excel(
  "C:/Users/satya/Downloads/202509 Trash Wheel Collection Data.xlsx",
  sheet = "Mr. Trash Wheel",
  range = readxl::cell_cols("A:N")
) %>%
  drop_na(Dumpster) %>%
  mutate(
    Year         = as.integer(Year),
    `Sports Balls` = as.integer(round(`Sports Balls`)),
    wheel        = "Mr. Trash Wheel"
  )

# Professor Trash Wheel  (all rows; columns A:M)  ← removed row limit that caused undercount
prof_trash <- read_excel(
  "C:/Users/satya/Downloads/202509 Trash Wheel Collection Data.xlsx",
  sheet = "Professor Trash Wheel",
  range = readxl::cell_cols("A:M")
) %>%
  drop_na(Dumpster) %>%
  mutate(
    Year         = as.integer(Year),
    `Sports Balls` = NA_integer_,
    wheel        = "Professor Trash Wheel"
  )

# Gwynns Falls Trash Wheel  (all rows; columns A:M)
gwynns_trash <- read_excel(
  "C:/Users/satya/Downloads/202509 Trash Wheel Collection Data.xlsx",
  sheet = "Gwynns Falls Trash Wheel",
  range = readxl::cell_cols("A:M")
) %>%
  drop_na(Dumpster) %>%
  mutate(
    Year         = as.integer(Year),
    `Sports Balls` = NA_integer_,
    wheel        = "Gwynns Falls Trash Wheel"
  )

# --- Combine, coerce numeric columns just in case, drop any stray '...#' columns ---

trash_wheel_data <- bind_rows(mr_trash, prof_trash, gwynns_trash) %>%
  select(-starts_with("...")) %>%
  mutate(across(c(`Weight (tons)`,
                  `Plastic Bottles`,
                  `Glass Bottles`,
                  `Plastic Bags`,
                  `Wrappers`,
                  `Cigarette Butts`,
                  `Sports Balls`),
                ~ suppressWarnings(as.numeric(.))))

# --- Inline-ready answers ---

# 1) # of observations in resulting dataset
n_obs <- nrow(trash_wheel_data)

# 2) Total weight of trash collected by Professor Trash Wheel (tons)
prof_weight <- trash_wheel_data %>%
  filter(wheel == "Professor Trash Wheel") %>%
  summarise(total_weight_tons = sum(`Weight (tons)`, na.rm = TRUE)) %>%
  pull(total_weight_tons)

# 3) Total number of cigarette butts collected by Gwynnda in June 2022
gwynnda_cigs <- trash_wheel_data %>%
  filter(wheel == "Gwynns Falls Trash Wheel",
         Year == 2022,
         tolower(Month) == "june") %>%
  summarise(total_cigs = sum(`Cigarette Butts`, na.rm = TRUE)) %>%
  pull(total_cigs)
```

```{r}
n_obs <- nrow(trash_wheel_data)

prof_weight <- trash_wheel_data %>%
  filter(wheel == "Professor Trash Wheel") %>%
  summarise(total_weight_tons = sum(`Weight (tons)`, na.rm = TRUE)) %>%
  pull(total_weight_tons)

gwynnda_cigs <- trash_wheel_data %>%
  filter(wheel == "Gwynns Falls Trash Wheel",
         Year == 2022,
         Month == "June") %>%
  summarise(total_cigs = sum(`Cigarette Butts`, na.rm = TRUE)) %>%
  pull(total_cigs)

```

The combined Trash Wheel dataset contains `r n_obs` observations across the three wheels.
The Professor Trash Wheel collected a total of `r round(prof_weight, 1)` tons of trash.  
In June 2022, Gwynnda collected `r gwynnda_cigs` cigarette butts.


#Problem 3
```{r}
knitr::opts_chunk$set(warning = FALSE)

library(tidyverse)
library(lubridate)

# ---- Load datasets ----
zori <- read_csv("C:/Users/satya/Downloads/Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv")
zip_lookup <- read_csv("C:/Users/satya/Downloads/Zip Codes.csv")

# ---- Clean ZIP lookup ----
zip_lookup <- zip_lookup %>%
  transmute(
    zip = as.character(ZipCode),
    borough = County,
    neighborhood = Neighborhood
  ) %>%
  distinct()

# ---- Tidy ZORI ----
zori_tidy <- zori %>%
  transmute(
    zip = as.character(RegionName),
    county = CountyName,
    across(matches("^\\d{4}-\\d{2}-\\d{2}$"))
  ) %>%
  pivot_longer(
    cols = matches("^\\d{4}-\\d{2}-\\d{2}$"),
    names_to = "date",
    values_to = "zori"
  ) %>%
  mutate(date = ymd(date),
         year = year(date),
         month = month(date, label = TRUE, abbr = FALSE))

# ---- Merge ----
zori_final <- zori_tidy %>%
  left_join(zip_lookup, by = "zip") %>%
  relocate(zip, borough, neighborhood, date, year, month, zori)

# ---- Summary numbers ----
n_obs <- nrow(zori_final)
n_zip <- n_distinct(zori_final$zip)
n_neigh <- n_distinct(zori_final$neighborhood, na.rm = TRUE)

# ---- ZIPs missing from Zillow ----
zips_missing <- zip_lookup %>%
  anti_join(zori_tidy %>% distinct(zip), by = "zip")

# Jan 2020 rents
jan2020 <- zori_final %>%
  filter(date == ymd("2020-01-31")) %>%
  distinct(zip, borough, .keep_all = TRUE) %>%
  select(zip, borough, neighborhood, zori_2020 = zori)

# Jan 2021 rents
jan2021 <- zori_final %>%
  filter(date == ymd("2021-01-31")) %>%
  distinct(zip, borough, .keep_all = TRUE) %>%
  select(zip, zori_2021 = zori)

# Calculate changes
drops <- jan2020 %>%
  inner_join(jan2021, by = "zip") %>%
  mutate(change = zori_2021 - zori_2020) %>%
  arrange(change)

# Top 10 ZIPs with largest drop
top10_drops <- drops %>% 
  slice_head(n = 10)

# View result table
knitr::kable(top10_drops, digits = 0)


```


Our tidy dataset contains `r n_obs` total observations, covering `r n_zip` unique ZIP codes 
and `r n_neigh` neighborhoods across the boroughs. 

There are `r n_zip` ZIP codes in the lookup file that do not appear in Zillow’s dataset.  
For example: `r paste(head(zips_missing$zip, 5), collapse = ", ")`.  

The 10 ZIP codes with the largest rent declines between Jan 2020 and Jan 2021 are shown above in Lower Manhattan. 




