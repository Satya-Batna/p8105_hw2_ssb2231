P8105_hw2_sbb2231
================
Satya Batna (sbb2231)

\#Problem 2

``` r
library (tidyverse)
```

    ## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
    ## ✔ dplyr     1.1.4     ✔ readr     2.1.5
    ## ✔ forcats   1.0.0     ✔ stringr   1.5.1
    ## ✔ ggplot2   3.5.2     ✔ tibble    3.3.0
    ## ✔ lubridate 1.9.4     ✔ tidyr     1.3.1
    ## ✔ purrr     1.1.0     
    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ dplyr::filter() masks stats::filter()
    ## ✖ dplyr::lag()    masks stats::lag()
    ## ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors

``` r
library(readxl)
library(dplyr)

# --- Read & clean each sheet (omit notes by dropping rows with missing Dumpster) ---

# Mr. Trash Wheel  (all rows; columns A:N)
mr_trash <- read_excel(
  "C:/Users/satya/Downloads/202509 Trash Wheel Collection Data.xlsx",
  sheet = "Mr. Trash Wheel",
  range = readxl::cell_cols("A:N")
) %>%
  drop_na(Dumpster) %>%
  mutate(
    Year         = as.integer(Year),
    `Sports Balls` = as.integer(round(`Sports Balls`)),
    wheel        = "Mr. Trash Wheel"
  )

# Professor Trash Wheel  (all rows; columns A:M)  ← removed row limit that caused undercount
prof_trash <- read_excel(
  "C:/Users/satya/Downloads/202509 Trash Wheel Collection Data.xlsx",
  sheet = "Professor Trash Wheel",
  range = readxl::cell_cols("A:M")
) %>%
  drop_na(Dumpster) %>%
  mutate(
    Year         = as.integer(Year),
    `Sports Balls` = NA_integer_,
    wheel        = "Professor Trash Wheel"
  )

# Gwynns Falls Trash Wheel  (all rows; columns A:M)
gwynns_trash <- read_excel(
  "C:/Users/satya/Downloads/202509 Trash Wheel Collection Data.xlsx",
  sheet = "Gwynns Falls Trash Wheel",
  range = readxl::cell_cols("A:M")
) %>%
  drop_na(Dumpster) %>%
  mutate(
    Year         = as.integer(Year),
    `Sports Balls` = NA_integer_,
    wheel        = "Gwynns Falls Trash Wheel"
  )
```

    ## New names:
    ## • `` -> `...13`

``` r
# --- Combine, coerce numeric columns just in case, drop any stray '...#' columns ---

trash_wheel_data <- bind_rows(mr_trash, prof_trash, gwynns_trash) %>%
  select(-starts_with("...")) %>%
  mutate(across(c(`Weight (tons)`,
                  `Plastic Bottles`,
                  `Glass Bottles`,
                  `Plastic Bags`,
                  `Wrappers`,
                  `Cigarette Butts`,
                  `Sports Balls`),
                ~ suppressWarnings(as.numeric(.))))

# --- Inline-ready answers ---

# 1) # of observations in resulting dataset
n_obs <- nrow(trash_wheel_data)

# 2) Total weight of trash collected by Professor Trash Wheel (tons)
prof_weight <- trash_wheel_data %>%
  filter(wheel == "Professor Trash Wheel") %>%
  summarise(total_weight_tons = sum(`Weight (tons)`, na.rm = TRUE)) %>%
  pull(total_weight_tons)

# 3) Total number of cigarette butts collected by Gwynnda in June 2022
gwynnda_cigs <- trash_wheel_data %>%
  filter(wheel == "Gwynns Falls Trash Wheel",
         Year == 2022,
         tolower(Month) == "june") %>%
  summarise(total_cigs = sum(`Cigarette Butts`, na.rm = TRUE)) %>%
  pull(total_cigs)
```

``` r
n_obs <- nrow(trash_wheel_data)

prof_weight <- trash_wheel_data %>%
  filter(wheel == "Professor Trash Wheel") %>%
  summarise(total_weight_tons = sum(`Weight (tons)`, na.rm = TRUE)) %>%
  pull(total_weight_tons)

gwynnda_cigs <- trash_wheel_data %>%
  filter(wheel == "Gwynns Falls Trash Wheel",
         Year == 2022,
         Month == "June") %>%
  summarise(total_cigs = sum(`Cigarette Butts`, na.rm = TRUE)) %>%
  pull(total_cigs)
```

The combined Trash Wheel dataset contains 1188 observations across the
three wheels. The Professor Trash Wheel collected a total of 282.3 tons
of trash.  
In June 2022, Gwynnda collected 1.812^{4} cigarette butts.

\#Problem 3

``` r
knitr::opts_chunk$set(warning = FALSE)

library(tidyverse)
library(lubridate)

# ---- Load datasets ----
zori <- read_csv("C:/Users/satya/Downloads/Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv")
```

    ## Rows: 149 Columns: 125
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr   (6): RegionType, StateName, State, City, Metro, CountyName
    ## dbl (119): RegionID, SizeRank, RegionName, 2015-01-31, 2015-02-28, 2015-03-3...
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
zip_lookup <- read_csv("C:/Users/satya/Downloads/Zip Codes.csv")
```

    ## Rows: 322 Columns: 7
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (4): County, County Code, File Date, Neighborhood
    ## dbl (3): State FIPS, County FIPS, ZipCode
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
# ---- Clean ZIP lookup ----
zip_lookup <- zip_lookup %>%
  transmute(
    zip = as.character(ZipCode),
    borough = County,
    neighborhood = Neighborhood
  ) %>%
  distinct()

# ---- Tidy ZORI ----
zori_tidy <- zori %>%
  transmute(
    zip = as.character(RegionName),
    county = CountyName,
    across(matches("^\\d{4}-\\d{2}-\\d{2}$"))
  ) %>%
  pivot_longer(
    cols = matches("^\\d{4}-\\d{2}-\\d{2}$"),
    names_to = "date",
    values_to = "zori"
  ) %>%
  mutate(date = ymd(date),
         year = year(date),
         month = month(date, label = TRUE, abbr = FALSE))

# ---- Merge ----
zori_final <- zori_tidy %>%
  left_join(zip_lookup, by = "zip") %>%
  relocate(zip, borough, neighborhood, date, year, month, zori)
```

    ## Warning in left_join(., zip_lookup, by = "zip"): Detected an unexpected many-to-many relationship between `x` and `y`.
    ## ℹ Row 4757 of `x` matches multiple rows in `y`.
    ## ℹ Row 256 of `y` matches multiple rows in `x`.
    ## ℹ If a many-to-many relationship is expected, set `relationship =
    ##   "many-to-many"` to silence this warning.

``` r
# ---- Summary numbers ----
n_obs <- nrow(zori_final)
n_zip <- n_distinct(zori_final$zip)
n_neigh <- n_distinct(zori_final$neighborhood, na.rm = TRUE)

# ---- ZIPs missing from Zillow ----
zips_missing <- zip_lookup %>%
  anti_join(zori_tidy %>% distinct(zip), by = "zip")

# Jan 2020 rents
jan2020 <- zori_final %>%
  filter(date == ymd("2020-01-31")) %>%
  distinct(zip, borough, .keep_all = TRUE) %>%
  select(zip, borough, neighborhood, zori_2020 = zori)

# Jan 2021 rents
jan2021 <- zori_final %>%
  filter(date == ymd("2021-01-31")) %>%
  distinct(zip, borough, .keep_all = TRUE) %>%
  select(zip, zori_2021 = zori)

# Calculate changes
drops <- jan2020 %>%
  inner_join(jan2021, by = "zip") %>%
  mutate(change = zori_2021 - zori_2020) %>%
  arrange(change)
```

    ## Warning in inner_join(., jan2021, by = "zip"): Detected an unexpected many-to-many relationship between `x` and `y`.
    ## ℹ Row 42 of `x` matches multiple rows in `y`.
    ## ℹ Row 42 of `y` matches multiple rows in `x`.
    ## ℹ If a many-to-many relationship is expected, set `relationship =
    ##   "many-to-many"` to silence this warning.

``` r
# Top 10 ZIPs with largest drop
top10_drops <- drops %>% 
  slice_head(n = 10)

# View result table
knitr::kable(top10_drops, digits = 0)
```

| zip   | borough  | neighborhood                  | zori_2020 | zori_2021 | change |
|:------|:---------|:------------------------------|----------:|----------:|-------:|
| 10007 | New York | Lower Manhattan               |      6334 |      5422 |   -913 |
| 10069 | New York | NA                            |      4623 |      3875 |   -748 |
| 10009 | New York | Lower East Side               |      3406 |      2692 |   -714 |
| 10016 | New York | Gramercy Park and Murray Hill |      3731 |      3019 |   -712 |
| 10001 | New York | Chelsea and Clinton           |      4108 |      3398 |   -710 |
| 10002 | New York | Lower East Side               |      3645 |      2935 |   -710 |
| 10004 | New York | Lower Manhattan               |      3150 |      2444 |   -706 |
| 10038 | New York | Lower Manhattan               |      3573 |      2876 |   -698 |
| 10012 | New York | Greenwich Village and Soho    |      3629 |      2942 |   -686 |
| 10010 | New York | Gramercy Park and Murray Hill |      3697 |      3012 |   -685 |

Our tidy dataset contains 17516 total observations, covering 149 unique
ZIP codes and 42 neighborhoods across the boroughs.

There are 149 ZIP codes in the lookup file that do not appear in
Zillow’s dataset.  
For example: 10464, 10474, 10475, 10499, 10550.

The 10 ZIP codes with the largest rent declines between Jan 2020 and Jan
2021 are shown above in Lower Manhattan.
